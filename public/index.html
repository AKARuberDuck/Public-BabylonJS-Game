<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>BabylonJS Game</title>
  <style>
    html, body { margin: 0; overflow: hidden; width: 100%; height: 100%; }
    #renderCanvas { width: 100%; height: 100%; touch-action: none; }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 20px;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 5px;
      line-height: 1.5em;
    }
  </style>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/cannon.js"></script>
</head>
<body>
  <div id="hud">
    <div><strong>Score:</strong> <span id="score">0</span></div>
    <div><strong>Time:</strong> <span id="time">30</span>s</div>
    <div><strong>Players Online:</strong> <span id="players">1</span></div>
  </div>
  <canvas id="renderCanvas"></canvas>

  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);
    const scene = new BABYLON.Scene(engine);

    let score = 0;
    let timeLeft = 30;

    const scoreText = document.getElementById("score");
    const timeText = document.getElementById("time");
    const playersText = document.getElementById("players");

    const camera = new BABYLON.ArcRotateCamera("camera", Math.PI / 2, Math.PI / 3, 10, BABYLON.Vector3.Zero(), scene);
    camera.attachControl(canvas, true);
    const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0), scene);

    scene.enablePhysics(new BABYLON.Vector3(0, -9.8, 0), new BABYLON.CannonJSPlugin());

    const ground = BABYLON.MeshBuilder.CreateGround("ground", {width: 10, height: 10}, scene);
    ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0 });

    function spawnSphere() {
      const sphere = BABYLON.MeshBuilder.CreateSphere("sphere", { diameter: 1 }, scene);
      sphere.position = new BABYLON.Vector3(Math.random() * 6 - 3, 2 + Math.random() * 3, Math.random() * 6 - 3);
      sphere.physicsImpostor = new BABYLON.PhysicsImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.9 });

      scene.onPointerObservable.add((pointerInfo) => {
        if (pointerInfo.pickInfo?.pickedMesh === sphere) {
          score++;
          scoreText.textContent = score;
          sphere.dispose();

          // (Optional) Broadcast score
          if (socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({ type: "score", value: score }));
          }
        }
      });
    }

    function spawnPowerUp() {
      const box = BABYLON.MeshBuilder.CreateBox("powerup", { size: 0.7 }, scene);
      box.position = new BABYLON.Vector3(Math.random() * 6 - 3, 1.5, Math.random() * 6 - 3);
      box.material = new BABYLON.StandardMaterial("mat", scene);
      box.material.diffuseColor = new BABYLON.Color3(0, 1, 0);
      setTimeout(() => box.dispose(), 10000);

      scene.onPointerObservable.add((pointerInfo) => {
        if (pointerInfo.pickInfo?.pickedMesh === box) {
          timeLeft += 5;
          timeText.textContent = timeLeft;
          box.dispose();
        }
      });
    }

    const gameInterval = setInterval(() => {
      timeLeft--;
      timeText.textContent = timeLeft;
      spawnSphere();
